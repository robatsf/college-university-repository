var Ge=Object.defineProperty;var Je=(t,r,s)=>r in t?Ge(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var J=(t,r,s)=>Je(t,typeof r!="symbol"?r+"":r,s);import{j as e,D as se,a as Se,b as Te,T as l,c as Pe,B as je,r as x,u as Xe,A as Qe,d as Ze,I as V,M as et,e as h,L as tt,f as rt,s as st,g as at,q as ot,h as q,S as Y,i as S,k as L,C as Ae,l as M,m as f,n as w,F as ae,o as oe,E as _e,p as ne,t as ie,v as le,w as m,x as ke,y as Fe,z as T,G as ce,H as g,J as nt,K as it,N as de,P as lt,O as pe,Q as ue,R as K,U as H,V as O,W as he,X as xe,Y as I,Z as ct,_ as dt,$ as pt,a0 as ut,a1 as ht,a2 as W,a3 as fe,a4 as xt,a5 as Ee,a6 as z,a7 as ft,a8 as $e,a9 as mt,aa as jt,ab as wt,ac as Be,ad as A,ae as we,af as gt,ag as yt,ah as ge,ai as vt,aj as bt,ak as me,al as Re,am as Dt,an as Ct,ao as D,ap as St,aq as Ie,ar as Le,as as Z,at as ze,au as He,av as Oe,aw as Me,ax as ee,ay as te,az as Tt,aA as Pt,aB as At,aC as _t,aD as kt,aE as Ft,aF as Et,aG as $t,aH as Bt}from"./vendor--6Cn_kVW.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();const Rt=({open:t,onClose:r,onConfirm:s})=>e.jsxs(se,{open:t,onClose:r,sx:{"& .MuiDialog-paper":{borderRadius:2,padding:2},"& .MuiBackdrop-root":{backgroundColor:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(4px)"}},children:[e.jsx(Se,{children:"Confirm Logout"}),e.jsx(Te,{children:e.jsx(l,{children:"Are you sure you want to logout?"})}),e.jsxs(Pe,{children:[e.jsx(je,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(je,{onClick:s,color:"error",variant:"contained",children:"Logout"})]})]}),It=({role:t})=>{const[r,s]=x.useState(!1),[o,a]=Xe(),n=()=>{localStorage.clear(),window.location.href="/login"};return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{position:"fixed",children:e.jsxs(Ze,{children:[e.jsx(V,{edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},onClick:()=>a(!o),children:e.jsx(et,{})}),e.jsx("img",{src:"../public/hu.jpeg",alt:"HUDC Logo",style:{height:40,marginRight:16,borderRadius:20}}),e.jsx(l,{variant:"h6",component:"div",sx:{flexGrow:1},children:"HUDC IRS"}),e.jsx(h,{sx:{display:"flex",alignItems:"center",gap:2},children:e.jsx(V,{color:"inherit",onClick:()=>s(!0),children:e.jsx(tt,{size:20,color:t==="librarian"?"#d32f2f":"#1976d2"})})})]})}),e.jsx(Rt,{open:r,onClose:()=>s(!1),onConfirm:n})]})},k=class k{constructor(){J(this,"refreshPromise",null)}static getInstance(){return k.instance||(k.instance=new k),k.instance}isTokenExpired(r){try{const s=rt(r),o=Math.floor(Date.now()/1e3);return s.exp<=o+30}catch{return!0}}showErrorMessage(r,s=5e3){const o=document.createElement("div");o.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9998;
      opacity: 0;
      transition: opacity 0.3s ease;
    `;const a=document.createElement("div");a.style.cssText=`
      background-color: #ef4444;
      color: white;
      padding: 20px 40px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      text-align: center;
      font-size: 16px;
      font-weight: 500;
      max-width: 400px;
      width: 90%;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
    `,a.textContent=r;const n=document.createElement("div");n.style.cssText=`
      margin-top: 12px;
      font-size: 14px;
      opacity: 0.8;
    `,o.appendChild(a),a.appendChild(n),document.body.appendChild(o),requestAnimationFrame(()=>{o.style.opacity="1",a.style.opacity="1",a.style.transform="translateY(0)"});let d=Math.floor(s/1e3);const p=()=>{n.textContent=`Redirecting in ${d} seconds...`};p();const c=setInterval(()=>{d--,p(),d<=0&&clearInterval(c)},1e3);setTimeout(()=>{o.style.opacity="0",a.style.opacity="0",a.style.transform="translateY(20px)",setTimeout(()=>{document.body.removeChild(o)},300)},s)}redirectToLogin(){setTimeout(()=>{window.location.href="/login"},5e3)}async refreshToken(){const r=localStorage.getItem("refresh_token");if(!r)return this.showErrorMessage("No refresh token found. Please login again."),this.redirectToLogin(),null;try{const s=await fetch(`${v}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:r})});if(!s.ok)throw new Error("Refresh failed");const o=await s.json();return localStorage.setItem("access_token",o.data.access_token),o.data.access_token}catch(s){return console.error("Token refresh failed:",s),localStorage.clear(),this.showErrorMessage("Session expired. Redirecting to login..."),this.redirectToLogin(),null}}async getValidToken(){const r=localStorage.getItem("access_token");if(!r)return this.showErrorMessage("No access token found. Please login."),this.redirectToLogin(),null;if(!this.isTokenExpired(r))return r;if(this.refreshPromise)return this.refreshPromise;this.refreshPromise=this.refreshToken();const s=await this.refreshPromise;return this.refreshPromise=null,s||(this.showErrorMessage("Failed to refresh token. Please login again."),this.redirectToLogin()),s}async getAuthHeaders(){const r=await this.getValidToken();return r||null}};J(k,"instance");let re=k;const b=re.getInstance(),v="http://127.0.0.1:8000/api/files",Lt="http://127.0.0.1:8000/media/",_=at,zt=st(v),P={...zt,create:async(t,r)=>_(`${v}/change-password/`,{method:"POST",body:JSON.stringify(r.data),headers:new Headers({"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${await b.getAuthHeaders()}`})}).then(({json:s})=>({data:s})).catch(s=>{throw s}),getList:async(t,r)=>{const o={approvals:{url:"list/",filter:{approved:"unapproved",disapproval_reason:null}},department_files:{url:"list/",filter:{approved:"approved"}},libapprovals:{url:"list/",filter:{approved:!1}}}[t]||{url:t,filter:{}},a=o.url,p={...!r.filter||Object.keys(r.filter).length===0?o.filter:r.filter},c=ot(p),i=`${v}/${a}?${c}`,u={headers:new Headers({Authorization:`Bearer ${await b.getAuthHeaders()}`})};try{const{json:j}=await _(i,u);return{data:j,total:j.length}}catch(j){throw console.error("Error fetching list:",j),new Error("Failed to fetch list")}},getdepartemnt:async(t,r)=>{try{const s=`${v}/${t}/`,o={headers:new Headers({Authorization:`Bearer ${await b.getAuthHeaders()}`})},a=await _(s,o);return JSON.parse(a.body)}catch(s){throw console.error("Error fetching resource:",s),new Error("Failed to fetch resource")}},getOne:async(t,r)=>{try{const o=`${v}/${{department_files:{url:"list/"},libapprovals:{url:"list/"},approvals:{url:"list/"}}[t].url}?id=${r.id}`,a={headers:new Headers({Authorization:`Bearer ${await b.getAuthHeaders()}`})},{json:n}=await _(o,a);return{data:n[0]}}catch(s){throw console.error("Error fetching resource:",s),new Error("Failed to fetch resource")}},createfile:async(t,r)=>{var a;const s=new FormData;s.append("title",r.data.title),s.append("author",r.data.author),s.append("description",r.data.description),s.append("file",r.data.file.rawFile),s.append("department_id",(a=r.data)==null?void 0:a.departemnt_id);const o=await b.getAuthHeaders();return fetch(`${v+t}`,{method:"POST",body:s,headers:{Authorization:`Bearer ${o}`}}).then(n=>{if(!n.ok)throw new Error("Failed to upload the file");return n.json()})},update:async(t,r)=>{var a,n;const s=`${v}/update/${r.id}/`,o=new FormData;return o.append("title",r.data.title),o.append("author",r.data.author),o.append("description",r.data.description),o.append("file",(n=(a=r.data)==null?void 0:a.file)==null?void 0:n.rawFile),_(s,{method:"PUT",body:o,headers:new Headers({Accept:"application/json",Authorization:`Bearer ${await b.getAuthHeaders()}`})}).then(({json:d})=>({data:d}))},delete:async(t,r)=>{const s=`${v}/delete/${r.id}/`;return _(s,{method:"DELETE",headers:new Headers({"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${await b.getAuthHeaders()}`})}).then(({json:o})=>({data:o}))},updateAppprove:async(t,r,s)=>{const o=`${v}/approval/${r}/`;return _(o,{method:"post",headers:new Headers({"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${await b.getAuthHeaders()}`}),body:JSON.stringify(s)})}},We=t=>e.jsx(q,{...t,children:e.jsx(Y,{label:"Upload"})}),Ht=()=>{const t=S(),r=L(),s=async o=>{try{await P.createfile("/create/",{data:o}),t("Department file created successfully",{type:"success"}),r("/department_files")}catch(a){t(`Error: ${a.message}`,{type:"error"})}};return e.jsx(Ae,{children:e.jsxs(M,{onSubmit:s,toolbar:e.jsx(We,{}),children:[e.jsx(f,{source:"title",label:"Title",fullWidth:!0,validate:[w()]}),e.jsx(f,{source:"author",label:"Author Name",fullWidth:!0,validate:[w()]}),e.jsx(f,{source:"department",label:"Department",defaultValue:"Default Department",fullWidth:!0,disabled:!0}),e.jsx(f,{source:"description",label:"Project/Research Description",multiline:!0,fullWidth:!0,validate:[w()]}),e.jsx(ae,{source:"file",label:"Upload File",accept:{"application/pdf":[".pdf"]},validate:[w()],children:e.jsx(oe,{source:"src",title:"title"})})]})})},Ot=t=>{const r=S(),s=L(),o=async a=>{try{await P.update("department_files",{id:a.id,data:a}),r("Department file updated successfully",{type:"success"}),s("/department_files")}catch(n){r(`Error: ${n.message}`,{type:"error"})}};return e.jsx(_e,{...t,children:e.jsxs(M,{toolbar:e.jsx(We,{}),onSubmit:o,children:[e.jsx(f,{source:"title",label:"Title",fullWidth:!0,validate:[w()]}),e.jsx(f,{source:"author",label:"Author Name",fullWidth:!0,validate:[w()]}),e.jsx(f,{source:"description",label:"Project/Research Description",multiline:!0,fullWidth:!0,validate:[w()]}),e.jsx(ae,{source:"file",label:"Upload File",accept:{"application/pdf":[".pdf"]},children:e.jsx(oe,{source:"src",title:"title"})})]})})},Mt=t=>e.jsxs(ne,{...t,children:[e.jsx(f,{label:"Search",source:"title",alwaysOn:!0}),e.jsx(f,{label:"Author",source:"author"})]}),Wt=()=>{const t=T();if(!t)return null;const r=t.description||"",s=r.length>10?`${r.substring(0,10)}...`:r;return e.jsx(ce,{title:r,placement:"top",arrow:!0,enterDelay:500,children:e.jsx(l,{sx:{cursor:"help","&:hover":{textDecoration:"underline",color:"primary.main"}},children:s})})},Ut=()=>e.jsx(ie,{filters:e.jsx(Mt,{}),sort:{field:"created_at",order:"DESC"},perPage:25,children:e.jsxs(le,{children:[e.jsx(m,{source:"title",label:"Title"}),e.jsx(m,{source:"author",label:"Author"}),e.jsx(Wt,{source:"description",label:"Description"}),e.jsx(ke,{}),e.jsx(Fe,{})]})}),Nt=g(se)(()=>({"& .MuiDialog-paper":{height:"99vh",maxWidth:"99vw",width:"90vw",backgroundColor:"#f5f5f5"}})),Vt=g(h)(()=>({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",backgroundColor:"#fff",borderBottom:"1px solid #e0e0e0"})),qt=g(h)(()=>({height:"calc(90vh - 64px)",overflow:"auto",padding:"16px",display:"flex",justifyContent:"center",backgroundColor:"#f5f5f5"})),Ue=({open:t,onClose:r,fileUrl:s,fileName:o})=>{const a=()=>{if(!s)return;const n=document.createElement("a");n.href=s,n.download=o||"download",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return e.jsxs(Nt,{open:t,onClose:r,children:[e.jsxs(Vt,{children:[e.jsx(l,{variant:"h6",children:o||"Document"}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(V,{onClick:a,title:"Download",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(nt,{}),e.jsx(l,{variant:"button",children:"Download"})]}),e.jsx(V,{onClick:r,size:"small",sx:{ml:1},title:"Close",children:e.jsx(it,{})})]})]}),e.jsx(qt,{children:s?e.jsx("iframe",{src:`${s}#toolbar=0&navpanes=0&view=FitH&zoom=50`,title:"PDF Viewer",style:{width:"100%",height:"100%",border:"none",WebkitTouchCallout:"none",userSelect:"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",overflow:"auto"},onContextMenu:n=>n.preventDefault()}):e.jsx(l,{children:"No file URL provided."})})]})},X=g(l)({display:"flex",alignItems:"center",gap:"8px",fontWeight:"bold",marginBottom:"16px",marginTop:"16px"}),E=g(h)({display:"flex",gap:"32px",marginBottom:"16px",alignItems:"center"}),Yt=t=>e.jsxs(ne,{...t,children:[e.jsx(f,{label:"Search",source:"title",alwaysOn:!0}),e.jsx(f,{label:"Author",source:"author"}),e.jsx(f,{label:"Year",source:"year"})]}),Kt=({open:t,onClose:r,onConfirm:s})=>{const[o,a]=x.useState(""),n=()=>{s(o),a("")};return e.jsxs(se,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Se,{children:"Why are you disapproving this file?"}),e.jsx(Te,{children:e.jsx(ut,{autoFocus:!0,margin:"dense",label:"Reason for disapproval",fullWidth:!0,multiline:!0,rows:4,value:o,onChange:d=>a(d.target.value)})}),e.jsxs(Pe,{children:[e.jsx(H,{onClick:r,color:"inherit",children:"Cancel"}),e.jsx(H,{onClick:n,color:"primary",disabled:!o.trim(),children:"Confirm Disapproval"})]})]})},ye=({type:t})=>{const r=T(),s=S(),o=ct(),a=L(),[n,d]=x.useState(!1),[p,c]=x.useState(!1);if(!r)return null;const i=()=>{t==="disapproved"?c(!0):u()},u=async j=>{d(!0);try{const y={status:t,...j&&{reason:j}},F=await P.updateAppprove("approvals",r.id,y);F.status===200?(s(`File ${t==="approved"?"approved":"disapproved"} successfully`,{type:"success"}),o(),a("list","approvals")):s(`Error: ${F.statusText}`,{type:"error"})}catch(y){s(`Error: ${y instanceof Error?y.message:"Unknown error occurred"}`,{type:"error"})}finally{d(!1),c(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"contained",color:t==="approved"?"success":"error",onClick:i,disabled:n,startIcon:t==="approved"?e.jsx(dt,{size:16}):e.jsx(pt,{size:16}),children:t==="approved"?"Approve":"Reject"}),e.jsx(Kt,{open:p,onClose:()=>c(!1),onConfirm:u})]})},Gt=()=>e.jsx(ie,{filters:e.jsx(Yt,{}),children:e.jsxs(le,{children:[e.jsx(m,{source:"title"}),e.jsx(m,{source:"author"}),e.jsx(m,{source:"description",label:"Description"}),e.jsx(m,{source:"approved",label:"Approval State"}),e.jsx(lt,{label:"View Details",icon:e.jsx(pe,{})})]})}),Jt=()=>e.jsx(de,{children:e.jsx(Xt,{})}),Xt=()=>{const t=T(),r=S(),[s,o]=x.useState(!1),[a,n]=x.useState(null),[d,p]=x.useState(null);if(!t)return null;const c=async i=>{try{const u=`${v}/view/${i}/`,j=await fetch(u,{method:"GET",headers:{Authorization:`Bearer ${await b.getAuthHeaders()}`,Accept:"application/json"}});if(!j.ok)throw new Error("Failed to fetch document");const y=await j.json();if(!y.file_url)throw new Error("Invalid response from server");p(t.file_extension),n(y.file_url),o(!0),r("Document loaded successfully",{type:"success"})}catch(u){console.error("Error viewing file:",u),r("Error loading document",{type:"error"})}};return e.jsxs(ue,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(X,{variant:"h6",children:[e.jsx(K,{size:20})," Basic Information"]}),e.jsxs(h,{display:"flex",gap:2,children:[e.jsx(H,{variant:"contained",color:"primary",startIcon:e.jsx(pe,{size:20}),onClick:()=>c(t.id),disabled:!(t!=null&&t.id),children:"View File"}),e.jsx(ye,{type:"approved"}),e.jsx(ye,{type:"disapproved"})]})]}),e.jsxs(E,{children:[e.jsx(l,{variant:"subtitle1",children:"Title:"}),e.jsx(m,{source:"title"})]}),e.jsxs(E,{children:[e.jsx(l,{variant:"subtitle1",children:"Description:"}),e.jsx(m,{source:"description"})]}),e.jsx(O,{}),e.jsxs(X,{variant:"h6",children:[e.jsx(he,{size:20})," Author & Department"]}),e.jsxs(E,{children:[e.jsx(l,{variant:"subtitle1",children:"Author:"}),e.jsx(m,{source:"author"})]}),e.jsxs(E,{children:[e.jsx(l,{variant:"subtitle1",children:"Department:"}),e.jsx(m,{source:"department"})]}),e.jsx(O,{}),e.jsxs(X,{variant:"h6",children:[e.jsx(xe,{size:20})," Timestamps"]}),e.jsxs(E,{children:[e.jsx(l,{variant:"subtitle1",children:"Created:"}),e.jsx(I,{source:"created_at",showTime:!0})]}),e.jsxs(E,{children:[e.jsx(l,{variant:"subtitle1",children:"Updated:"}),e.jsx(I,{source:"updated_time",showTime:!0})]}),e.jsx(Ue,{open:s,onClose:()=>o(!1),fileUrl:a,fileName:(t==null?void 0:t.title)||"Document",fileType:d})]})},Qt=(t,r)=>{if(t!==r.newPassword)return"Passwords do not match"},Zt=t=>{if(!t)return"Required";if(t.length<8)return"Password must be at least 8 characters"},ve=({message:t})=>t?e.jsx(l,{color:"error",variant:"caption",sx:{mt:-1,mb:1,display:"block"},children:t}):null,er=({saving:t,...r})=>e.jsxs(q,{...r,sx:{display:"flex",justifyContent:"center"},children:[e.jsx(Y,{label:"Update Password",disabled:t}),t&&e.jsx(fe,{size:24,sx:{ml:1}})]}),tr=()=>{const t=S(),r=L();ht();const[s,o]=x.useState(!1),[a,n]=x.useState({}),d=async p=>{o(!0),n({});try{const c={old_password:p.oldPassword,new_password:p.newPassword};await P.create("change-password",{data:c}),t("Password updated successfully",{type:"success"}),r("/")}catch(c){if(console.error("Password update error:",c),c.body&&typeof c.body=="object"){const i=c.body,u={};i.old_password&&(u.oldPassword=Array.isArray(i.old_password)?i.old_password[0]:i.old_password),i.new_password&&(u.newPassword=Array.isArray(i.new_password)?i.new_password[0]:i.new_password),Object.keys(u).length>0?(n(u),t("Please correct the errors below",{type:"warning"})):i.detail||i.error?t(`Error: ${i.detail||i.error}`,{type:"error"}):t("An error occurred while updating your password",{type:"error"})}else{const i=c.message||"An unexpected error occurred";t(`Error: ${i}`,{type:"error"})}}finally{o(!1)}};return e.jsx(h,{children:e.jsxs(W,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Update Password"}),e.jsxs(M,{onSubmit:d,toolbar:e.jsx(er,{saving:s}),sx:{"& .RaSimpleForm-form":{display:"flex",flexDirection:"column",gap:2}},children:[e.jsx(f,{source:"oldPassword",label:"Current Password",type:"password",fullWidth:!0,validate:[w()],sx:{mb:a.oldPassword?0:2},error:!!a.oldPassword}),e.jsx(ve,{message:a.oldPassword}),e.jsx(f,{source:"newPassword",label:"New Password",type:"password",fullWidth:!0,validate:[w(),Zt],helperText:"Password must be at least 8 characters",sx:{mb:a.newPassword?0:2},error:!!a.newPassword}),e.jsx(ve,{message:a.newPassword}),e.jsx(f,{source:"confirmPassword",label:"Confirm New Password",type:"password",fullWidth:!0,validate:[w(),Qt],sx:{mb:2}})]})]})})},rr=(t,r)=>{if(t!==r.newPassword)return"Passwords do not match"},sr=t=>{if(!t)return"Required";if(t.length<8)return"Password must be at least 8 characters"},be=({message:t})=>t?e.jsx(l,{color:"error",variant:"caption",sx:{mt:-1,mb:1,display:"block"},children:t}):null,ar=({saving:t,...r})=>e.jsxs(q,{...r,sx:{display:"flex",justifyContent:"center"},children:[e.jsx(Y,{label:"Update Password",disabled:t}),t&&e.jsx(fe,{size:24,sx:{ml:1}})]}),or=()=>{const t=S(),r=L(),[s,o]=x.useState(!1),[a,n]=x.useState({}),d=async p=>{o(!0),n({});try{const c={old_password:p.oldPassword,new_password:p.newPassword};await P.create("change-password",{data:c}),t("Password updated successfully",{type:"success"}),r("/")}catch(c){if(console.error("Password update error:",c),c.body&&typeof c.body=="object"){const i=c.body,u={};i.old_password&&(u.oldPassword=Array.isArray(i.old_password)?i.old_password[0]:i.old_password),i.new_password&&(u.newPassword=Array.isArray(i.new_password)?i.new_password[0]:i.new_password),Object.keys(u).length>0?(n(u),t("Please correct the errors below",{type:"warning"})):i.detail||i.error?t(`Error: ${i.detail||i.error}`,{type:"error"}):t("An error occurred while updating your password",{type:"error"})}else{const i=c.message||"An unexpected error occurred";t(`Error: ${i}`,{type:"error"})}}finally{o(!1)}};return e.jsx(h,{children:e.jsxs(W,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Update Password"}),e.jsxs(M,{onSubmit:d,toolbar:e.jsx(ar,{saving:s}),sx:{"& .RaSimpleForm-form":{display:"flex",flexDirection:"column",gap:2}},children:[e.jsx(f,{source:"oldPassword",label:"Current Password",type:"password",fullWidth:!0,validate:[w()],sx:{mb:a.oldPassword?0:2},error:!!a.oldPassword}),e.jsx(be,{message:a.oldPassword}),e.jsx(f,{source:"newPassword",label:"New Password",type:"password",fullWidth:!0,validate:[w(),sr],helperText:"Password must be at least 8 characters",sx:{mb:a.newPassword?0:2},error:!!a.newPassword}),e.jsx(be,{message:a.newPassword}),e.jsx(f,{source:"confirmPassword",label:"Confirm New Password",type:"password",fullWidth:!0,validate:[w(),rr],sx:{mb:2}})]})]})})},Q=g(l)({display:"flex",alignItems:"center",gap:"8px",fontWeight:"bold",marginBottom:"16px",marginTop:"16px"}),$=g(h)({display:"flex",gap:"32px",marginBottom:"16px",alignItems:"center"}),nr=()=>{const t=T(),r=S(),[s,o]=x.useState(!1),[a,n]=x.useState(null),[d,p]=x.useState(null),c=async i=>{try{const u=`${v}/view/${i}/`,j=await fetch(u,{method:"GET",headers:{Authorization:`Bearer ${await b.getAuthHeaders()}`,Accept:"application/json"}});if(!j.ok)throw new Error("Failed to fetch document");const y=await j.json();if(!y.file_url)throw new Error("Invalid response from server");p(t==null?void 0:t.file_extension),n(y.file_url),o(!0),r("Document loaded successfully",{type:"success"})}catch(u){console.error("Error viewing file:",u),r("Error loading document",{type:"error"})}};return e.jsxs(e.Fragment,{children:[e.jsx(xt,{children:e.jsx(H,{label:"View File",onClick:()=>c(t==null?void 0:t.id),icon:e.jsx(pe,{size:20}),disabled:!(t!=null&&t.id)})}),e.jsx(Ue,{open:s,onClose:()=>o(!1),fileUrl:a,fileName:(t==null?void 0:t.title)||"Document",fileType:d})]})},ir=()=>e.jsx(de,{actions:e.jsx(nr,{}),children:e.jsxs(ue,{children:[e.jsxs(Q,{variant:"h6",children:[e.jsx(K,{size:20})," Basic Information"]}),e.jsxs($,{children:[e.jsx(l,{variant:"subtitle1",children:"Title:"}),e.jsx(m,{source:"title"})]}),e.jsxs($,{children:[e.jsx(l,{variant:"subtitle1",children:"Description:"}),e.jsx(m,{source:"description"})]}),e.jsx(O,{}),e.jsxs(Q,{variant:"h6",children:[e.jsx(he,{size:20})," Author & Department"]}),e.jsxs($,{children:[e.jsx(l,{variant:"subtitle1",children:"Author:"}),e.jsx(m,{source:"author"})]}),e.jsxs($,{children:[e.jsx(l,{variant:"subtitle1",children:"Department:"}),e.jsx(m,{source:"department"})]}),e.jsx(O,{}),e.jsxs(Q,{variant:"h6",children:[e.jsx(xe,{size:20})," Timestamps"]}),e.jsxs($,{children:[e.jsx(l,{variant:"subtitle1",children:"Created:"}),e.jsx(I,{source:"created_at",showTime:!0})]}),e.jsxs($,{children:[e.jsx(l,{variant:"subtitle1",children:"Updated:"}),e.jsx(I,{source:"updated_time",showTime:!0})]})]})}),Ne=()=>{const[t,r]=x.useState([]);return x.useEffect(()=>{(async()=>{try{const o=await b.getAuthHeaders();if(!o)throw new Error("No token found");const a=await fetch(`${v}/departments/?all=true`,{headers:{Authorization:`Bearer ${o}`,Accept:"*/*"}});if(!a.ok)throw new Error("Failed to fetch departments");const n=await a.json();if(n.status==="success"){const d=n.data.departments.map(p=>({id:p.id,name:p.name}));r(d)}}catch(o){console.error("Error fetching departments:",o),r([])}})()},[]),t},lr=t=>{Ne();const r=["approved","unapproved"];return e.jsxs(ne,{...t,children:[e.jsx(f,{label:"Search",source:"title",alwaysOn:!0}),e.jsx(f,{label:"Author",source:"author"}),e.jsx(Ee,{label:"approved",choices:r,source:"approved"})]})},cr=g(l,{shouldForwardProp:t=>t!=="status"})(({theme:t,status:r})=>({display:"flex",alignItems:"center",gap:"8px",color:r==="approved"?t.palette.success.main:r==="rejected"?t.palette.error.main:t.palette.warning.main,fontWeight:500})),dr=()=>{const t=T();if(!t)return null;const r=t.description||"",s=r.length>10?`${r.substring(0,10)}...`:r;return e.jsx(ce,{title:r,placement:"top",arrow:!0,enterDelay:500,children:e.jsx(l,{sx:{cursor:"help","&:hover":{textDecoration:"underline"}},children:s})})},pr=()=>{const t=T();if(!t)return null;const s=t.approved==="unapproved"?t.disapproval_reason?{text:"Rejected",status:"rejected",icon:e.jsx(z,{size:16}),tooltipText:`Rejection Reason: ${t.disapproval_reason}`}:{text:"Pending",status:"pending",icon:e.jsx(ft,{size:16}),tooltipText:"Awaiting approval"}:{text:"Approved",status:"approved",icon:e.jsx($e,{size:16}),tooltipText:"Approved"};return e.jsxs(cr,{status:s.status,children:[s.text,e.jsx(ce,{title:e.jsxs(h,{children:[e.jsx(l,{variant:"body2",children:s.tooltipText}),t.updated_time&&e.jsxs(l,{variant:"caption",display:"block",children:["Last updated: ",new Date(t.updated_time).toLocaleString()]})]}),arrow:!0,children:s.icon})]})},ur=()=>e.jsx(ie,{filters:e.jsx(lr,{}),sort:{field:"created_at",order:"DESC"},perPage:25,children:e.jsxs(le,{children:[e.jsx(m,{source:"title",label:"Title"}),e.jsx(m,{source:"author",label:"Author"}),e.jsx(pr,{source:"approved",label:"Status"}),e.jsx(dr,{source:"description",label:"Description"}),e.jsx(ke,{}),e.jsx(Fe,{})]})}),hr=t=>e.jsx(q,{...t,children:e.jsx(Y,{label:"Upload"})}),Ve=({isEdit:t=!1,onSubmit:r})=>{const s=Ne();return e.jsxs(M,{toolbar:e.jsx(hr,{}),onSubmit:r,children:[e.jsx(f,{source:"title",label:"Title",fullWidth:!0,validate:[w()]}),e.jsx(f,{source:"author",label:"Author Name",fullWidth:!0,validate:[w()]}),e.jsx(Ee,{source:"departemnt_id",label:"Department",choices:s,optionText:"name",optionValue:"id",fullWidth:!0,validate:[w()]}),e.jsx(f,{source:"description",label:"Project/Research Description",multiline:!0,fullWidth:!0,validate:[w()]}),e.jsx(ae,{source:"file",label:"Upload File",accept:{"application/pdf":[".pdf"]},validate:t?void 0:[w()],children:e.jsx(oe,{source:"src",title:"title"})})]})},xr=()=>{const t=S(),r=L(),s=async o=>{try{await P.createfile("/create/",{data:o}),t("Librarian file created successfully",{type:"success"}),r("/libapprovals")}catch(a){t(`Error: ${a.message}`,{type:"error"})}};return e.jsx(Ae,{children:e.jsx(Ve,{onSubmit:s})})},fr=()=>e.jsx(_e,{children:e.jsx(Ve,{isEdit:!0})}),U=g(mt)(({theme:t})=>({padding:t.spacing(3),marginBottom:t.spacing(3),borderRadius:t.shape.borderRadius})),N=g(l)({display:"flex",alignItems:"center",gap:"8px",fontWeight:"bold",marginBottom:"16px",marginTop:"16px"}),B=g(h)({display:"flex",gap:"32px",marginBottom:"16px",alignItems:"center"}),mr=g(h)(({theme:t})=>({marginBottom:t.spacing(3),"& .MuiAlert-root":{marginBottom:t.spacing(2)}})),jr=g(jt)(({theme:t,status:r})=>({marginBottom:t.spacing(2),padding:t.spacing(1),backgroundColor:r==="approved"?t.palette.success.light:r==="disapproved"?t.palette.error.light:t.palette.warning.light,color:r==="approved"?t.palette.success.dark:r==="disapproved"?t.palette.error.dark:t.palette.warning.dark,"& .MuiChip-icon":{color:"inherit"}})),wr=()=>{const t=T();if(!t)return null;const s=t.approved==="approved"?{icon:e.jsx($e,{size:20}),label:"Approved",color:"success"}:t.approved==="unapproved"&&t.disapproval_reason?{icon:e.jsx(z,{size:20}),label:"Disapproved",color:"error"}:{icon:e.jsx(z,{size:20}),label:"Pending",color:"warning"};return e.jsx(mr,{children:e.jsxs(h,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(jr,{icon:s.icon,label:s.label,status:t.approved}),t.approved==="unapproved"&&t.disapproval_reason&&e.jsx(wt,{severity:"error",icon:e.jsx(z,{size:20}),sx:{"& .MuiAlert-message":{width:"100%"}},children:e.jsxs(h,{children:[e.jsx(l,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:"Disapproval Reason:"}),e.jsx(l,{variant:"body2",paragraph:!0,children:t.disapproval_reason}),e.jsx(O,{sx:{my:1}}),e.jsxs(l,{variant:"caption",color:"text.secondary",children:["Disapproved on: ",new Date(t.updated_time).toLocaleString()]})]})})]})})},gr=()=>{const t=T();return e.jsx(de,{children:e.jsxs(ue,{children:[e.jsxs(U,{elevation:1,children:[e.jsx(wr,{}),e.jsxs(N,{variant:"h6",children:[e.jsx(K,{size:20})," Basic Information"]}),e.jsxs(B,{children:[e.jsx(l,{variant:"subtitle1",children:"Title:"}),e.jsx(m,{source:"title"})]}),e.jsxs(B,{children:[e.jsx(l,{variant:"subtitle1",children:"Description:"}),e.jsx(m,{source:"description"})]})]}),e.jsxs(U,{elevation:1,children:[e.jsxs(N,{variant:"h6",children:[e.jsx(he,{size:20})," Author"]}),e.jsxs(B,{children:[e.jsx(l,{variant:"subtitle1",children:"Author:"}),e.jsx(m,{source:"author"})]})]}),e.jsxs(U,{elevation:1,children:[e.jsxs(N,{variant:"h6",children:[e.jsx(xe,{size:20})," Timestamps"]}),e.jsxs(B,{children:[e.jsx(l,{variant:"subtitle1",children:"Created:"}),e.jsx(I,{source:"created_at",showTime:!0})]}),e.jsxs(B,{children:[e.jsx(l,{variant:"subtitle1",children:"Updated:"}),e.jsx(I,{source:"updated_time",showTime:!0})]})]}),(t==null?void 0:t.approved)==="disapproved"&&e.jsxs(U,{elevation:1,children:[e.jsxs(N,{variant:"h6",children:[e.jsx(z,{size:20})," Disapproval Information"]}),e.jsxs(B,{children:[e.jsx(l,{variant:"subtitle1",children:"Reason:"}),e.jsx(m,{source:"disapproval_reason"})]})]})]})})},De=()=>{window.location="/"},yr={librarian:[e.jsx(A,{name:"home",list:De,icon:we,options:{label:"Home"}},"home"),e.jsx(A,{name:"libapprovals",list:ur,create:xr,edit:fr,show:gr,icon:K,options:{label:"Library Files"}},"files"),e.jsx(A,{name:"updatePassword",list:tr,icon:ge,options:{label:"Update Password"}},"updatePassword")],department_head:[e.jsx(A,{name:"home",list:De,icon:we,options:{label:"Home"}},"home"),e.jsx(A,{name:"approvals",list:Gt,show:Jt,icon:gt,options:{label:"Department Approvals"}},"approvals"),e.jsx(A,{name:"department_files",list:Ut,edit:Ot,create:Ht,show:ir,icon:yt,options:{label:"Department Files"}},"deptfiles"),e.jsx(A,{name:"updatePassword",list:or,icon:ge,options:{label:"Update Password"}},"updatePassword")]},vr=Be({palette:{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0",contrastText:"#ffffff"},secondary:{main:"#000000"},background:{default:"#ffffff",paper:"#ffffff"}},typography:{fontFamily:"Arial, sans-serif"},components:{MuiAppBar:{styleOverrides:{root:{backgroundColor:"#1976d2"}}}}}),br=t=>{const r=localStorage.getItem("role")||"librarian";return e.jsx(vt,{theme:vr,children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(It,{role:r}),e.jsx(h,{component:"main",sx:{flexGrow:1,pt:3},children:e.jsx(bt,{...t,sx:{"& .RaLayout-content":{pl:5}}})})]})})},Dr=g(me)(({theme:t})=>({height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}})),Cr=g(Re)(({theme:t})=>({background:t.palette.grey[50]})),R=({title:t,value:r,icon:s,trend:o})=>{const a=Dt(),n=o>0?a.palette.success.main:a.palette.error.main;return e.jsxs(Dr,{children:[e.jsx(Cr,{title:e.jsxs(h,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(l,{variant:"h6",children:t}),s&&e.jsx(s,{size:24})]})}),e.jsxs(W,{children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:r}),o!==void 0&&e.jsxs(l,{style:{color:n},children:[o>0?"+":"",o,"% from last month"]})]})]})},Sr=g(me)(({theme:t})=>({height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}})),qe=({role:t,name:r,image_path:s})=>e.jsx(Sr,{sx:{mb:3,minHeight:110,maxHeight:110},children:e.jsx(W,{sx:{py:2},children:e.jsxs(h,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Ct,{sx:{bgcolor:"primary.main",width:48,height:48},children:e.jsx("img",{src:Lt+s,alt:"Profile",className:"w-12 h-12 rounded-full object-cover shadow-lg border-2 border-b-amber-300"})}),e.jsxs(h,{children:[e.jsxs(l,{variant:"h5",component:"div",children:["Welcome, ",r]}),e.jsx(l,{variant:"body2",color:"textSecondary",children:t==="librarian"?"Manage and track library resources efficiently":"Monitor your department's research activities"})]})]})})}),Tr=()=>{try{const t=localStorage.getItem("access_token");if(!t)return null;const r=t.split(".")[1],s=JSON.parse(atob(r));return{user_id:s.user_id,user_name:s.user_name,department:s.department,department_id:s.department_id,email:s.email,image_path:s.image_path,user_type:s.user_type}}catch(t){return console.error("Error decoding token:",t),null}},Pr=g(me)(({theme:t})=>({height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:t.shadows[4]},borderRadius:t.shape.borderRadius,overflow:"hidden"})),Ar=g(Re)(({theme:t})=>({background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.grey[900],borderBottom:`1px solid ${t.palette.divider}`,"& .MuiCardHeader-title":{fontSize:"1.125rem",fontWeight:600,color:t.palette.text.primary},"& .MuiCardHeader-subheader":{fontSize:"0.875rem",color:t.palette.text.secondary},padding:t.spacing(2)})),Ce=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],_r=()=>{const[t,r]=x.useState([]),[s,o]=x.useState({total_departments:0,total_files:0,total_downloads:0,total_history:0,total_unapproved:0}),[a,n]=x.useState([]);x.useEffect(()=>{const p=async()=>{try{const i=await b.getAuthHeaders();if(!i)throw new Error("No token found");const u=await fetch(`${v}/departments/?all=true`,{headers:{Authorization:`Bearer ${i}`,Accept:"*/*"}});if(!u.ok)throw new Error("Failed to fetch departments");const j=await u.json();j.status==="success"&&(r(j.data.departments),o(j.data.statistics))}catch(i){console.error("Error fetching departments:",i)}},c=async()=>{const i=await Tr();n(i)};p(),c()},[]);const d=t.map(p=>({name:p.name,uploads:p.file_count,downloads:p.download_total,value:p.history_total}));return e.jsxs(h,{p:3,children:[e.jsx(qe,{role:a.user_type,name:a.user_name,image_path:a.image_path}),e.jsxs(D,{container:!0,spacing:4,children:[e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(R,{title:"Total Departments",value:s.total_departments,icon:St,trend:0})}),e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(R,{title:"Total Files",value:s.total_files,icon:Ie,trend:12})}),e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(R,{title:"Total Downloads",value:s.total_downloads,icon:Le,trend:8})}),e.jsx(D,{item:!0,xs:12,children:e.jsxs(Pr,{children:[e.jsx(Ar,{title:"Department Statistics"}),e.jsx(W,{children:e.jsxs(h,{display:"flex",gap:2,children:[e.jsx(h,{flex:2,height:400,children:e.jsx(Z,{width:"100%",height:"100%",children:e.jsxs(ze,{data:d,children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(Oe,{dataKey:"name"}),e.jsx(Me,{}),e.jsx(ee,{}),e.jsx(te,{dataKey:"uploads",fill:"#1976d2",name:"Files"}),e.jsx(te,{dataKey:"downloads",fill:"#dc004e",name:"Downloads"})]})})}),e.jsx(h,{flex:1,height:400,children:e.jsx(Z,{width:"100%",height:"100%",children:e.jsxs(Tt,{children:[e.jsx(Pt,{data:d,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:!0,children:d.map((p,c)=>e.jsx(At,{fill:Ce[c%Ce.length]},`cell-${c}`))}),e.jsx(ee,{})]})})})]})})]})})]})]})},kr=()=>{const[t,r]=x.useState(null),[s,o]=x.useState(!0),[a,n]=x.useState(null),[d,p]=x.useState([{name:"Total Files",value:0},{name:"Total Downloads",value:0}]),[c,i]=x.useState(0),[u,j]=x.useState([]);x.useEffect(()=>{const F=async()=>{try{const C=await P.getdepartemnt("departments",{});r(C.data.departments[0]),p([{name:"Total Files",value:C.data.departments[0].file_count},{name:"Total Downloads",value:C.data.departments[0].download_total}]),i(C.data.statistics.total_departments)}catch{n("Error loading department data")}finally{o(!1)}},G=async()=>{const C=await getTokenData();j(C)};F(),G()},[]);const y=F=>{if(!t||!t.created_at)return 0;const G=new Date(t.created_at),Ye=Math.abs(new Date-G),Ke=Math.ceil(Ye/(1e3*60*60*24));return F/Ke};return s?e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(fe,{})}):a?e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(l,{style:{color:"red",textAlign:"center"},children:a})}):e.jsxs(h,{p:3,children:[e.jsx(qe,{role:u.user_type,name:u.user_name,image_path:u.image_path}),e.jsx(D,{container:!0,spacing:3,children:t?e.jsxs(e.Fragment,{children:[e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(R,{title:"Total Files",value:t.file_count,icon:Ie,trend:y(t.file_count)})}),e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(R,{title:"Total Downloads",value:t.download_total,icon:Le,trend:y(t.download_total)})}),e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(R,{title:"Total department",value:c,icon:_t,trend:y(c)})}),e.jsx(D,{item:!0,xs:12,children:e.jsx(Z,{width:"100%",height:300,children:e.jsxs(ze,{data:d,children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(Oe,{dataKey:"name"}),e.jsx(Me,{}),e.jsx(ee,{}),e.jsx(te,{dataKey:"value",fill:"#1976d2"})]})})})]}):e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(l,{style:{color:"red",textAlign:"center"},children:"No data Found"})})})]})};Be({palette:{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0",contrastText:"#ffffff"},secondary:{main:"#000000"},background:{default:"#ffffff",paper:"#ffffff"}},typography:{fontFamily:"Arial, sans-serif"},components:{MuiAppBar:{styleOverrides:{root:{backgroundColor:"#1976d2"}}}}});const Fr=()=>{const t=localStorage.getItem("user_type")||"department_head",r=yr[t]||[];return["librarian","department_head"].includes(t)||(window.location.href="/login"),e.jsx(kt,{title:"HUDC IR SYSTEM",layout:br,dataProvider:P,darkTheme:null,dashboard:t==="department_head"?kr:_r,children:r})},Er=Ft([{path:"*",element:e.jsx(Fr,{})}]);Et.createRoot(document.getElementById("root")).render(e.jsx($t.StrictMode,{children:e.jsx(Bt,{router:Er})}));
//# sourceMappingURL=index-CY4MKKcl.js.map
